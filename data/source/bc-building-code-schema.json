{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://bcbuildingcode.ca/schemas/bc-building-code-json.schema.json",
  "title": "BC Building Code JSON Schema",
  "description": "JSON Schema for validating BC Building Code JSON output generated from canonical XML",
  "type": "object",
  "required": ["document_type", "version", "canonical_version", "generated_timestamp", "volumes", "statistics"],
  "properties": {
    "document_type": {
      "type": "string",
      "const": "bc_building_code",
      "description": "Document type identifier"
    },
    "version": {
      "type": "string",
      "description": "NBC version (e.g., '2020')"
    },
    "canonical_version": {
      "type": "string",
      "description": "Canonical format version"
    },
    "generated_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of JSON generation"
    },
    "metadata": {
      "$ref": "#/definitions/metadata",
      "description": "Document metadata (optional, controlled by include-metadata parameter)"
    },
    "front_matter": {
      "$ref": "#/definitions/front_matter",
      "description": "Front matter content including preface, introduction, and committees"
    },
    "volumes": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/volume"
      },
      "description": "Volumes (1 and 2) containing divisions, index, and conversions"
    },
    "cross_references": {
      "$ref": "#/definitions/cross_references",
      "description": "Cross-reference index (optional, controlled by include-cross-references parameter)"
    },
    "bc_amendments": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/bc_amendment"
      },
      "description": "BC-specific amendments and revisions (optional, controlled by include-bc-annotations parameter)"
    },
    "glossary": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/glossary_entry"
      },
      "description": "Glossary of defined terms"
    },
    "statistics": {
      "$ref": "#/definitions/statistics",
      "description": "Document statistics"
    }
  },
  "definitions": {
    "front_matter": {
      "type": "object",
      "required": ["id"],
      "description": "Front matter content including preface, introduction, and committees",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the front matter section"
        },
        "preface": {
          "$ref": "#/definitions/preface",
          "description": "Preface section with introductory content about the code"
        },
        "introduction": {
          "$ref": "#/definitions/introduction",
          "description": "Introduction section with standards and conformity assessment information"
        },
        "committees": {
          "$ref": "#/definitions/committees",
          "description": "Committees section listing commission and standing committee members"
        }
      }
    },
    "preface": {
      "type": "object",
      "required": ["id", "type", "content"],
      "description": "Preface section containing introductory paragraphs and headings",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the preface"
        },
        "type": {
          "type": "string",
          "const": "preface"
        },
        "content": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/front_matter_content_item"
          },
          "description": "Array of content items (paragraphs, headings, tables, figures, lists)"
        }
      }
    },
    "introduction": {
      "type": "object",
      "required": ["id", "type", "content"],
      "description": "Introduction section with standards and conformity assessment information",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the introduction"
        },
        "type": {
          "type": "string",
          "const": "introduction"
        },
        "title": {
          "type": "string",
          "description": "Main title of the introduction section"
        },
        "content": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/front_matter_content_item"
          },
          "description": "Array of content items (paragraphs, headings, tables, figures, lists)"
        }
      }
    },
    "committees": {
      "type": "object",
      "required": ["id", "type"],
      "description": "Committees section listing commission and standing committee members",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the committees section"
        },
        "type": {
          "type": "string",
          "const": "committees"
        },
        "title": {
          "type": "string",
          "description": "Title of the committees section"
        },
        "tables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/table"
          },
          "description": "Tables listing committee members"
        },
        "notes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {
                "type": "string"
              },
              "content": {
                "type": "string"
              }
            }
          },
          "description": "Notes about committee membership (e.g., term start dates)"
        }
      }
    },
    "front_matter_content_item": {
      "type": "object",
      "required": ["type"],
      "description": "A content item within front matter sections",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["paragraph", "heading", "table", "figure", "list"],
          "description": "Type of content item"
        },
        "id": {
          "type": "string",
          "description": "Unique identifier for the content item"
        },
        "content": {
          "type": "string",
          "description": "Text content (for paragraphs and headings)"
        },
        "level": {
          "type": "number",
          "minimum": 1,
          "maximum": 6,
          "description": "Heading level (1-6, for heading type only)"
        },
        "title": {
          "type": "string",
          "description": "Title (for tables and figures)"
        },
        "structure": {
          "type": "object",
          "description": "Table structure (for table type only)",
          "properties": {
            "columns": {
              "type": ["number", "null"]
            },
            "colsep": {
              "type": "string"
            },
            "rowsep": {
              "type": "string"
            },
            "column_specs": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "width": {"type": "string"}
                }
              }
            },
            "header_rows": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/table_row"
              }
            },
            "body_rows": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/table_row"
              }
            }
          }
        },
        "table_notes": {
          "type": "array",
          "description": "Resolved table note objects keyed by note ID",
          "items": {
            "$ref": "#/definitions/table_note"
          }
        },
        "graphic": {
          "type": "object",
          "description": "Graphic information (for figure type only)",
          "properties": {
            "src": {
              "type": "string"
            },
            "alt_text": {
              "type": "string"
            }
          }
        },
        "list_type": {
          "type": "string",
          "enum": ["bulleted", "numbered"],
          "description": "List type (for list type only)"
        },
        "items": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List items (for list type only)"
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["title", "authority"],
      "properties": {
        "title": {
          "type": "string"
        },
        "subtitle": {
          "type": "string"
        },
        "authority": {
          "type": "string"
        },
        "publication_date": {
          "type": "string"
        },
        "nrc_number": {
          "type": "string"
        },
        "isbn": {
          "type": "string"
        },
        "volumes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "volume": {
                "type": "string"
              },
              "title": {
                "type": "string"
              },
              "subtitle": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "volume": {
      "type": "object",
      "required": ["id", "number", "title", "divisions"],
      "description": "Physical publication volume containing divisions, index, and conversions",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]$",
          "description": "Volume identifier (e.g., 'nbc.2020.vol1', 'nbc.2020.vol2')"
        },
        "number": {
          "type": "number",
          "enum": [1, 2],
          "description": "Volume number (1 or 2)"
        },
        "title": {
          "type": "string",
          "description": "Volume title (e.g., 'National Building Code of Canada 2020 - Volume 1')"
        },
        "divisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/division"
          },
          "description": "Divisions contained in this volume"
        },
        "index": {
          "$ref": "#/definitions/index",
          "description": "Volume-specific alphabetical index of terms with references to code sections"
        },
        "conversions": {
          "$ref": "#/definitions/conversions",
          "description": "Volume-specific conversion factors table for metric/imperial units"
        }
      }
    },
    "back_matter": {
      "type": "object",
      "required": ["id"],
      "description": "DEPRECATED: Back matter content. Index and conversions are now volume-specific and located within each volume element. This definition is kept for backward compatibility only.",
      "deprecated": true,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the back matter section"
        },
        "index": {
          "$ref": "#/definitions/index",
          "description": "Alphabetical index of terms with references to code sections"
        },
        "conversions": {
          "$ref": "#/definitions/conversions",
          "description": "Conversion factors table for metric/imperial units"
        }
      }
    },
    "index": {
      "type": "object",
      "required": ["id", "type", "letters"],
      "description": "Alphabetical index of terms with references to code sections (volume-specific)",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]\\.index$",
          "description": "Volume-specific index identifier (e.g., 'nbc.2020.vol1.index', 'nbc.2020.vol2.index')"
        },
        "type": {
          "type": "string",
          "const": "index"
        },
        "introduction": {
          "type": "string",
          "description": "Introductory text explaining index notation (e.g., division markers)"
        },
        "letters": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/index_letter"
          },
          "description": "Index entries grouped by letter (A-Z)"
        }
      }
    },
    "index_letter": {
      "type": "object",
      "required": ["id", "letter", "groups"],
      "description": "Index entries for a specific letter",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]\\.index\\.[A-Z]$",
          "description": "Volume-specific letter group identifier (e.g., 'nbc.2020.vol1.index.A', 'nbc.2020.vol2.index.B')"
        },
        "letter": {
          "type": "string",
          "pattern": "^[A-Z]$",
          "description": "Letter for this group (A-Z)"
        },
        "groups": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/index_group"
          },
          "description": "Index term groups within this letter"
        }
      }
    },
    "index_group": {
      "type": "object",
      "required": ["id", "term_id", "term"],
      "description": "A main index term with optional subterms",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]\\.index\\.[A-Z]\\.group\\d+$",
          "description": "Volume-specific group identifier (e.g., 'nbc.2020.vol1.index.A.group1')"
        },
        "term_id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]\\.index\\.[A-Z]\\.group\\d+\\.term\\d+$",
          "description": "Volume-specific main term identifier (e.g., 'nbc.2020.vol1.index.A.group1.term1')"
        },
        "term": {
          "type": "string",
          "description": "Main index term text"
        },
        "references": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/index_reference"
          },
          "description": "References to code sections for this term"
        },
        "subterms": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/index_subterm"
          },
          "description": "Sub-terms under this main term"
        }
      }
    },
    "index_subterm": {
      "type": "object",
      "required": ["id", "term"],
      "description": "A sub-term under a main index term",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]\\.index\\.[A-Z]\\.group\\d+\\.subterm\\d+\\.term\\d+$",
          "description": "Volume-specific sub-term identifier (e.g., 'nbc.2020.vol1.index.A.group1.subterm1.term1')"
        },
        "term": {
          "type": "string",
          "description": "Sub-term text"
        },
        "references": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/index_reference"
          },
          "description": "References to code sections for this sub-term"
        }
      }
    },
    "index_reference": {
      "type": "object",
      "required": ["target"],
      "description": "A reference from an index term to a code section",
      "properties": {
        "target": {
          "type": "string",
          "description": "Canonical ID of the referenced code section (e.g., 'nbc.divB.part1.sect3.subsect2.art1')"
        },
        "vendor_target": {
          "type": "string",
          "description": "Original NBC vendor ID (e.g., 'ea000104')"
        },
        "division": {
          "type": "string",
          "enum": ["1", "2"],
          "description": "Division indicator: '1' for Division A/C, '2' for Division B Part 9"
        }
      }
    },
    "conversions": {
      "type": "object",
      "required": ["id", "type", "table_id", "table_title", "table_structure"],
      "description": "Conversion factors table for metric/imperial units (volume-specific)",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]\\.conversions$",
          "description": "Volume-specific conversions identifier (e.g., 'nbc.2020.vol1.conversions', 'nbc.2020.vol2.conversions')"
        },
        "type": {
          "type": "string",
          "const": "conversions"
        },
        "table_id": {
          "type": "string",
          "pattern": "^nbc\\.\\d{4}\\.vol[12]\\.conversions\\.table\\d+$",
          "description": "Volume-specific conversion table identifier (e.g., 'nbc.2020.vol1.conversions.table1')"
        },
        "table_title": {
          "type": "string",
          "description": "Title of the conversion table (e.g., 'Conversion Factors')"
        },
        "table_structure": {
          "type": "object",
          "required": ["body_rows"],
          "description": "Table structure with conversion factors",
          "properties": {
            "columns": {
              "type": ["number", "null"],
              "description": "Number of columns in the table"
            },
            "column_specs": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "width": {"type": "string"}
                }
              },
              "description": "Column specifications with names and widths"
            },
            "header_rows": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/table_row"
              },
              "description": "Header rows with column titles"
            },
            "body_rows": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/table_row"
              },
              "description": "Body rows with conversion factors"
            }
          }
        }
      }
    },
    "division": {
      "type": "object",
      "required": ["id", "type", "letter", "title", "parts"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\.div[A-Z0-9]+$"
        },
        "type": {
          "type": "string",
          "const": "division"
        },
        "letter": {
          "type": "string",
          "pattern": "^[A-Z]+$"
        },
        "title": {
          "type": "string"
        },
        "number": {
          "type": "string"
        },
        "parts": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/part"
          }
        }
      }
    },
    "part": {
      "type": "object",
      "required": ["id", "type", "title", "sections"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\.div[A-Z0-9]+\\.part\\d+$"
        },
        "type": {
          "type": "string",
          "const": "part"
        },
        "number": {
          "type": ["number", "null"]
        },
        "title": {
          "type": "string"
        },
        "see_also": {
          "type": "string"
        },
        "sections": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/section"
          }
        },
        "special_tables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/spectables"
          }
        },
        "appendix": {
          "$ref": "#/definitions/part_appendix"
        }
      }
    },
    "section": {
      "type": "object",
      "required": ["id", "type", "title", "subsections"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\.div[A-Z0-9]+\\.part\\d+\\.sect\\d+$"
        },
        "type": {
          "type": "string",
          "const": "section"
        },
        "number": {
          "type": ["number", "null"]
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this section has been deleted (true when deleted='yes' attribute is present)"
        },
        "title": {
          "type": "string"
        },
        "subsections": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/subsection"
          }
        }
      }
    },
    "subsection": {
      "type": "object",
      "required": ["id", "type", "title", "articles"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\.div[A-Z0-9]+\\.part\\d+\\.sect\\d+\\.subsect\\d+$"
        },
        "type": {
          "type": "string",
          "const": "subsection"
        },
        "number": {
          "type": ["number", "null"]
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this subsection has been deleted (true when deleted='yes' attribute is present)"
        },
        "revised": {
          "type": "boolean",
          "description": "Indicates if this subsection has revision history (true when revised='yes' attribute is present)"
        },
        "source": {
          "type": "string",
          "enum": ["nbc", "bc"],
          "description": "Source of the subsection - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
        },
        "title": {
          "type": "string"
        },
        "see_also": {
          "type": "string"
        },
        "articles": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/article"
          }
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          },
          "description": "Revision history for this subsection (original baseline and all revisions)"
        }
      }
    },
    "article": {
      "type": "object",
      "required": ["id", "type", "title", "content"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\.div[A-Z0-9]+\\.part\\d+\\.sect\\d+\\.subsect\\d+\\.art\\d+$"
        },
        "type": {
          "type": "string",
          "const": "article"
        },
        "number": {
          "type": ["number", "null"]
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this article has been deleted (true when deleted='yes' attribute is present)"
        },
        "revised": {
          "type": "boolean",
          "description": "Indicates if this article has revision history (true when revised='yes' attribute is present)"
        },
        "source": {
          "type": "string",
          "enum": ["nbc", "bc"],
          "description": "Source of the article - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
        },
        "title": {
          "type": "string"
        },
        "see_also": {
          "type": "string"
        },
        "content": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "type"],
            "properties": {
              "id": {"type": "string"},
              "type": {"type": "string", "enum": ["sentence", "table", "figure"]}
            },
            "oneOf": [
              {
                "properties": {
                  "type": {"const": "sentence"}
                },
                "required": ["id", "type", "text"]
              },
              {
                "properties": {
                  "type": {"const": "table"}
                },
                "required": ["id", "type", "title", "structure"]
              },
              {
                "properties": {
                  "type": {"const": "figure"}
                },
                "required": ["id", "type", "title", "graphic"]
              }
            ]
          }
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          },
          "description": "Revision history for this article (original baseline and all revisions)"
        }
      }
    },
    "sentence": {
      "type": "object",
      "required": ["id", "type", "text"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\..+\\.sent\\d+$"
        },
        "type": {
          "type": "string",
          "const": "sentence"
        },
        "number": {
          "type": ["number", "null"]
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this sentence has been deleted (true when deleted='yes' attribute is present)"
        },
        "revised": {
          "type": "boolean",
          "description": "Indicates if this sentence has revision history (true when revised='yes' attribute is present)"
        },
        "source": {
          "type": "string",
          "enum": ["nbc", "bc"],
          "description": "Source of the sentence - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
        },
        "text": {
          "type": "string"
        },
        "equations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/equation"
          },
          "description": "Mathematical equations contained in this sentence"
        },
        "intent_reference": {
          "type": "string"
        },
        "clauses": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/clause"
          }
        },
        "see_also": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "content": {"type": "string"}
            }
          }
        },
        "objectives": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/objective"
          }
        },
        "functional_statements": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/functional_statement"
          }
        },
        "bc_annotations": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/bc_annotation"
          }
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          },
          "description": "Revision history for this sentence (original baseline and all revisions)"
        }
      }
    },
    "clause": {
      "type": "object",
      "required": ["id", "type", "letter", "text"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\..+\\.sent\\d+\\.clause\\d+$"
        },
        "type": {
          "type": "string",
          "const": "clause"
        },
        "letter": {
          "type": "string",
          "pattern": "^[a-z]$"
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this clause has been deleted (true when deleted='yes' attribute is present)"
        },
        "revised": {
          "type": "boolean",
          "description": "Indicates if this clause has revision history (true when revised='yes' attribute is present)"
        },
        "source": {
          "type": "string",
          "enum": ["nbc", "bc"],
          "description": "Source of the clause - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
        },
        "text": {
          "type": "string"
        },
        "see_also": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "content": {"type": "string"}
            }
          }
        },
        "subclauses": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/subclause"
          }
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          },
          "description": "Revision history for this clause (original baseline and all revisions)"
        }
      }
    },
    "subclause": {
      "type": "object",
      "required": ["id", "type", "text"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^(nbc|bc)\\..+\\.subclause\\d+$"
        },
        "type": {
          "type": "string",
          "const": "subclause"
        },
        "number": {
          "type": ["number", "null"]
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this subclause has been deleted (true when deleted='yes' attribute is present)"
        },
        "revised": {
          "type": "boolean",
          "description": "Indicates if this subclause has revision history (true when revised='yes' attribute is present)"
        },
        "source": {
          "type": "string",
          "enum": ["nbc", "bc"],
          "description": "Source of the subclause - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
        },
        "text": {
          "type": "string"
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          },
          "description": "Revision history for this subclause (original baseline and all revisions)"
        }
      }
    },
    "equation": {
      "type": "object",
      "required": ["id", "type"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Equation identifier (xml:id, image reference, or html source filename fallback)"
        },
        "type": {
          "type": "string",
          "enum": ["display", "inline"],
          "description": "Equation display type: 'display' for block-level equations, 'inline' for inline equations"
        },
        "latex": {
          "type": "string",
          "description": "LaTeX representation of the equation for mathematical rendering (e.g., 'C_{s}\\\\frac{60\\\\text{째}-a}{53\\\\text{째}}')"
        },
        "plainText": {
          "type": "string",
          "description": "Plain text representation of the equation for accessibility (e.g., 'C_s(60째-a)/(53째)')"
        },
        "mathml": {
          "type": "string",
          "description": "Full MathML XML serialization for precise mathematical semantics"
        },
        "htmlSrc": {
          "type": "string",
          "description": "Path to equation HTML file for rendering (e.g., 'graphics/eg/025/eg02506a.html')"
        },
        "image": {
          "type": "string",
          "description": "Legacy image reference identifier (e.g., 'eg02764a')"
        },
        "imageSrc": {
          "type": "string",
          "description": "Legacy EPS equation path for backward compatibility (e.g., 'graphics/eg02764a.eps')"
        }
      }
    },
    "table": {
      "type": "object",
      "required": ["id", "type", "title", "structure"],
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "table"
        },
        "frame": {
          "type": "string"
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this table has been deleted (true when deleted='yes' attribute is present)"
        },
        "title": {
          "type": "string"
        },
        "table_notes": {
          "type": "array",
          "description": "Resolved table note objects keyed by note ID",
          "items": {
            "$ref": "#/definitions/table_note"
          }
        },
        "structure": {
          "type": "object",
          "required": ["body_rows"],
          "properties": {
            "columns": {
              "type": ["number", "null"]
            },
            "colsep": {
              "type": "string"
            },
            "rowsep": {
              "type": "string"
            },
            "column_specs": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "width": {"type": "string"}
                }
              }
            },
            "header_rows": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/table_row"
              }
            },
            "body_rows": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/table_row"
              }
            }
          }
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          }
        }
      }
    },
    "table_row": {
      "type": "object",
      "required": ["id", "type", "cells"],
      "description": "A row in a table (header or body)",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the row"
        },
        "type": {
          "type": "string",
          "enum": ["header_row", "body_row"],
          "description": "Type of row"
        },
        "valign": {
          "type": "string"
        },
        "rowsep": {
          "type": "string"
        },
        "cells": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/table_entry"
          },
          "description": "Cells in this row"
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          }
        }
      }
    },
    "table_entry": {
      "type": "object",
      "required": ["content"],
      "properties": {
        "content": {
          "type": "array",
          "description": "Array of content items (text or figures) in the cell",
          "items": {
            "$ref": "#/definitions/cell_content_item"
          }
        },
        "align": {
          "type": "string",
          "enum": ["left", "center", "right", "justify", "char"]
        },
        "valign": {
          "type": "string"
        },
        "colsep": {
          "type": "string"
        },
        "rowsep": {
          "type": "string"
        },
        "colname": {
          "type": "string"
        },
        "namest": {
          "type": "string"
        },
        "nameend": {
          "type": "string"
        },
        "rowspan": {
          "type": "number",
          "minimum": 1
        },
        "colspan": {
          "type": "number",
          "minimum": 1
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          }
        }
      }
    },
    "table_note": {
      "type": "object",
      "required": ["id", "content"],
      "properties": {
        "id": {"type": "string"},
        "vendor_id": {"type": "string"},
        "content": {"type": "string"}
      }
    },
    "cell_content_item": {
      "type": "object",
      "required": ["type"],
      "description": "Content item in a table cell - either text or figure",
      "oneOf": [
        {
          "type": "object",
          "required": ["type", "value"],
          "properties": {
            "type": {
              "type": "string",
              "const": "text"
            },
            "value": {
              "type": "string",
              "description": "Text content of the cell"
            }
          },
          "additionalProperties": false
        },
        {
          "type": "object",
          "required": ["type", "id", "graphic"],
          "properties": {
            "type": {
              "type": "string",
              "const": "figure"
            },
            "id": {
              "type": "string",
              "description": "Unique identifier for the figure"
            },
            "source": {
              "type": "string",
              "enum": ["bc", "nbc"],
              "description": "Source of the figure (BC amendment or original NBC)"
            },
            "title": {
              "type": "string",
              "description": "Figure title/caption"
            },
            "graphic": {
              "type": "object",
              "required": ["src"],
              "properties": {
                "src": {
                  "type": "string",
                  "description": "Path to the graphic file"
                },
                "alt_text": {
                  "type": "string",
                  "description": "Alternative text for accessibility"
                },
                "width": {
                  "type": "string",
                  "description": "Width of the graphic"
                },
                "height": {
                  "type": "string",
                  "description": "Height of the graphic"
                }
              }
            }
          }
        }
      ]
    },
    "figure": {
      "type": "object",
      "required": ["id", "type", "title", "graphic"],
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "figure"
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this figure has been deleted (true when deleted='yes' attribute is present)"
        },
        "title": {
          "type": "string"
        },
        "graphic": {
          "type": "object",
          "required": ["src", "alt_text"],
          "properties": {
            "src": {
              "type": "string"
            },
            "alt_text": {
              "type": "string"
            },
            "width": {
              "type": "string"
            },
            "height": {
              "type": "string"
            }
          }
        },
        "notes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "content": {"type": "string"}
            }
          }
        }
      }
    },
    "spectables": {
      "type": "object",
      "required": ["id", "type", "title", "tables"],
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "spectables"
        },
        "title": {
          "type": "string"
        },
        "table_prefix": {
          "type": "string"
        },
        "toc_entry": {
          "type": "string"
        },
        "tables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/table"
          }
        }
      }
    },
    "part_appendix": {
      "type": "object",
      "required": ["id", "type", "application_notes"],
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "part_appendix"
        },
        "introduction": {
          "type": "string"
        },
        "application_notes": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/application_note"
          }
        }
      }
    },
    "application_note": {
      "type": "object",
      "required": ["id", "type", "number", "title"],
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "application_note"
        },
        "number": {
          "type": "string"
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this application note has been deleted (true when deleted='yes' attribute is present)"
        },
        "title": {
          "type": "string"
        },
        "refs": {
          "type": "string"
        },
        "paragraphs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "content": {"type": "string"}
            }
          }
        },
        "divisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/note_division"
          }
        },
        "tables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/table"
          }
        },
        "figures": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/figure"
          }
        },
        "revisions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/revision"
          }
        }
      }
    },
    "note_division": {
      "type": "object",
      "required": ["id", "type", "title"],
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "const": "note_division"
        },
        "title": {
          "type": "string"
        },
        "paragraphs": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": {"type": "string"},
              "content": {"type": "string"}
            }
          }
        },
        "tables": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/table"
          }
        },
        "figures": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/figure"
          }
        }
      }
    },
    "objective": {
      "type": "object",
      "required": ["id", "key", "title", "definition"],
      "properties": {
        "id": {
          "type": "string"
        },
        "key": {
          "type": "string"
        },
        "source": {
          "type": "string",
          "enum": ["nbc", "bc"],
          "description": "Source of the objective - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
        },
        "title": {
          "type": "string"
        },
        "definition": {
          "type": "string"
        },
        "sub_objectives": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "key", "title", "definition"],
            "properties": {
              "id": {"type": "string"},
              "key": {"type": "string"},
              "source": {
                "type": "string",
                "enum": ["nbc", "bc"],
                "description": "Source of the sub-objective - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
              },
              "title": {"type": "string"},
              "definition": {"type": "string"}
            }
          }
        }
      }
    },
    "functional_statement": {
      "type": "object",
      "required": ["id", "key", "definition"],
      "properties": {
        "id": {
          "type": "string"
        },
        "key": {
          "type": "string"
        },
        "source": {
          "type": "string",
          "enum": ["nbc", "bc"],
          "description": "Source of the functional statement - 'nbc' for National Building Code, 'bc' for BC-specific modifications"
        },
        "definition": {
          "type": "string"
        }
      }
    },
    "bc_annotation": {
      "type": "object",
      "required": ["type", "content"],
      "properties": {
        "type": {
          "type": "string"
        },
        "content": {
          "type": "string"
        }
      }
    },
    "revision": {
      "type": "object",
      "required": ["type", "effective_date"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["original", "revision"]
        },
        "revision_type": {
          "type": "string",
          "enum": ["amendment", "errata", "policy", "accessibility", "correction"]
        },
        "revision_id": {
          "type": "string"
        },
        "sequence": {
          "type": ["number", "null"]
        },
        "effective_date": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "status": {
          "type": "string",
          "enum": ["current", "superseded"]
        },
        "deleted": {
          "type": "boolean",
          "description": "Indicates if this revision represents a deletion (true when revision content is empty)"
        },
        "change_summary": {
          "type": "string"
        },
        "note": {
          "type": "string"
        }
      }
    },
    "cross_references": {
      "type": "object",
      "required": ["internal_references", "external_references", "standard_references", "term_references"],
      "properties": {
        "internal_references": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["source_id", "target_id"],
            "properties": {
              "source_id": {"type": "string"},
              "target_id": {"type": "string"},
              "display_type": {"type": "string"},
              "pretext": {"type": "string"}
            }
          }
        },
        "external_references": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["source_id", "target", "text"],
            "properties": {
              "source_id": {"type": "string"},
              "target": {"type": "string"},
              "text": {"type": "string"}
            }
          }
        },
        "standard_references": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["source_id", "standard_id", "text"],
            "properties": {
              "source_id": {"type": "string"},
              "standard_id": {"type": "string"},
              "text": {"type": "string"}
            }
          }
        },
        "term_references": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["source_id", "term_id", "text"],
            "properties": {
              "source_id": {"type": "string"},
              "term_id": {"type": "string"},
              "text": {"type": "string"}
            }
          }
        }
      }
    },
    "bc_amendment": {
      "type": "object",
      "required": ["location_id", "type", "content"],
      "properties": {
        "location_id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": ["original", "revision", "annotation", "insert", "replace", "modify", "delete", "remove"]
        },
        "annotation_type": {
          "type": "string"
        },
        "amendment_id": {
          "type": "string"
        },
        "revision_type": {
          "type": "string",
          "enum": ["amendment", "errata", "policy", "accessibility", "correction"]
        },
        "revision_id": {
          "type": "string"
        },
        "sequence": {
          "type": ["number", "null"]
        },
        "effective_date": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
        },
        "status": {
          "type": "string",
          "enum": ["current", "superseded"]
        },
        "content": {
          "type": "string"
        },
        "change_summary": {
          "type": "string"
        },
        "note": {
          "type": "string"
        }
      }
    },
    "glossary_entry": {
      "type": "object",
      "required": ["term", "definition", "location_id"],
      "properties": {
        "term": {
          "type": "string"
        },
        "definition": {
          "type": "string"
        },
        "location_id": {
          "type": "string"
        }
      }
    },
    "statistics": {
      "type": "object",
      "required": [
        "total_volumes",
        "total_divisions",
        "total_parts",
        "total_sections",
        "total_articles",
        "total_sentences",
        "total_tables",
        "total_figures",
        "total_spectables",
        "total_application_notes",
        "total_index_entries",
        "total_index_references"
      ],
      "properties": {
        "total_volumes": {
          "type": "number",
          "minimum": 0,
          "description": "Total number of volumes (typically 2 for NBC 2020)"
        },
        "total_divisions": {"type": "number", "minimum": 0},
        "total_parts": {"type": "number", "minimum": 0},
        "total_sections": {"type": "number", "minimum": 0},
        "total_articles": {"type": "number", "minimum": 0},
        "total_sentences": {"type": "number", "minimum": 0},
        "total_tables": {"type": "number", "minimum": 0},
        "total_figures": {"type": "number", "minimum": 0},
        "total_spectables": {"type": "number", "minimum": 0},
        "total_application_notes": {"type": "number", "minimum": 0},
        "total_index_entries": {
          "type": "number",
          "minimum": 0,
          "description": "Total number of index entries across all volumes (main terms + subterms)"
        },
        "total_index_references": {
          "type": "number",
          "minimum": 0,
          "description": "Total number of index references to code sections across all volumes"
        },
        "total_index_entries_vol1": {
          "type": "number",
          "minimum": 0,
          "description": "Number of index entries in Volume 1 (main terms + subterms)"
        },
        "total_index_entries_vol2": {
          "type": "number",
          "minimum": 0,
          "description": "Number of index entries in Volume 2 (main terms + subterms)"
        },
        "total_index_references_vol1": {
          "type": "number",
          "minimum": 0,
          "description": "Number of index references to code sections in Volume 1"
        },
        "total_index_references_vol2": {
          "type": "number",
          "minimum": 0,
          "description": "Number of index references to code sections in Volume 2"
        }
      }
    }
  }
}
